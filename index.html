<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ã‚‚ã˜ã´ã£ãŸã‚“ æ¤œç´¢ãƒ„ãƒ¼ãƒ«</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      margin: 2rem;
      line-height: 1.6;
    }
    input {
      font-size: 1.1rem;
      padding: 0.4rem;
      width: 12rem;
    }
    ul {
      margin-top: 1rem;
      padding-left: 0;
      list-style: none; /* ãƒªã‚¹ãƒˆã®ãƒ»ã‚’æ¶ˆã—ã¦è¦‹ã‚„ã™ã */
    }
    li {
      margin-bottom: 0.5rem;
      border-bottom: 1px solid #eee; /* åŒºåˆ‡ã‚Šç·š */
      padding-bottom: 0.5rem;
    }
    /* è¦‹ã‚„ã™ãã™ã‚‹ãŸã‚ã®è£…é£¾ */
    .word-reading {
      font-weight: bold;
      color: #007bff;
      margin-right: 0.5em;
    }
    .word-notation {
      font-weight: bold;
      margin-right: 0.5em;
    }
    .word-meaning {
      color: #555;
      font-size: 0.9em;
    }/* æ–‡å­—ã‚’è¶³ã—ã¦åˆ¥ã®è¨€è‘‰ã«ãªã‚‹å˜èªç”¨ã®ã‚¹ã‚¿ã‚¤ãƒ« */
.extendable {
  background-color: #e0f7fa; /* æ°´è‰²ã£ã½ã„èƒŒæ™¯ */
  border-left: 4px solid #00acc1; /* å·¦ã«å¼·èª¿ç·š */
  padding-left: 0.5rem;
}
.extendable::after {
  content: ' ğŸ”—'; /* ãƒªãƒ³ã‚¯ã®ã‚ˆã†ãªã‚¢ã‚¤ã‚³ãƒ³ã‚’ã¤ã‘ã¦ã¿ã‚‹ */
  font-size: 0.8em;
}
  </style>
</head>
<body>
  <h1>ã‚‚ã˜ã´ã£ãŸã‚“ è¾æ›¸æ¤œç´¢</h1>

  <p>
    æ¤œç´¢æ–‡å­—åˆ—(ï¼’æ–‡å­—ä»¥ä¸Š)ã‚’å…¥åŠ›ã™ã‚‹ã¨ã€<br>
    <strong>ãã®æ–‡å­—åˆ—ã‚’å«ã‚€ã€Œèª­ã¿ã€</strong>ã‚’æŒã¤å˜èªã‚’è¡¨ç¤ºã—ã¾ã™ã€‚
  </p>

  <input id="query" placeholder="ä¾‹ï¼šã‚ã„" />

  <ul id="results"></ul>

  <script>
    // å°æ›¸ãä»®å â†’ é€šå¸¸ä»®å
    const normalizeMap = {
      'ã':'ã‚','ãƒ':'ã„','ã…':'ã†','ã‡':'ãˆ','ã‰':'ãŠ',
      'ã‚ƒ':'ã‚„','ã‚…':'ã‚†','ã‚‡':'ã‚ˆ','ã£':'ã¤','ã‚':'ã‚'
    };

    function normalize(str) {
      return str
        .split('')
        // ã‚«ã‚¿ã‚«ãƒŠ â†’ ã²ã‚‰ãŒãª
        .map(c => {
          const code = c.charCodeAt(0);
          if (code >= 0x30A1 && code <= 0x30F6) {
            return String.fromCharCode(code - 0x60);
          }
          return c;
        })
        // å°æ–‡å­— â†’ å¤§æ–‡å­—
        .map(c => normalizeMap[c] || c)
        .join('');
    }


    // ...ï¼ˆnormalizeé–¢æ•°ãªã©ã¯ãã®ã¾ã¾ï¼‰...

let dictionary = [];

fetch('dictionary.json')
  .then(res => res.json())
  .then(data => {
    // 1. ã¾ãšåŸºæœ¬ãƒ‡ãƒ¼ã‚¿ã‚’æ•´å½¢
    dictionary = data
      .filter(e => e.reading && e.reading.length > 0)
      .map(e => ({
        searchKey: normalize(e.reading),
        reading: e.reading,
        notation: e.notation,
        meaning: e.meaning,
        isExtendable: false // åˆæœŸå€¤ã¯false
      }));

    // 2. é«˜é€Ÿæ¤œç´¢ç”¨ã®ãƒãƒƒãƒ—ã‚’ä½œæˆ (key: èª­ã¿, value: ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ)
    const dictionaryMap = new Map();
    dictionary.forEach(item => {
      dictionaryMap.set(item.searchKey, item);
    });

    // 3. ã€Œé€†å¼•ãã€ã§ã¤ãªãŒã‚Šã‚’äº‹å‰è¨ˆç®—
    // ä¾‹ï¼šã€Œã‚Šã‚“ã”ã‚ã‚ã€ãŒã‚ã‚‹ãªã‚‰ã€ã€Œã‚Šã‚“ã”ã€ã® isExtendable ã‚’ true ã«ã™ã‚‹
    dictionary.forEach(longWord => {
      const k = longWord.searchKey;
      if (k.length < 2) return; // 1æ–‡å­—ã®å˜èªã‹ã‚‰ã¯å‰Šã‚Œãªã„ã®ã§ã‚¹ã‚­ãƒƒãƒ—

      // æœ«å°¾ã‚’1æ–‡å­—å‰Šã‚‹ï¼ˆä¾‹ï¼šã‚Šã‚“ã”ã‚ã‚ â†’ ã‚Šã‚“ã”ï¼‰
      const parentKey = k.slice(0, -1);

      // å‰Šã£ãŸå˜èªãŒè¾æ›¸ã«å­˜åœ¨ã™ã‚Œã°ã€ãã®ã€ŒçŸ­ã„æ–¹ã®å˜èªã€ã«ãƒ•ãƒ©ã‚°ã‚’ç«‹ã¦ã‚‹
      if (dictionaryMap.has(parentKey)) {
        dictionaryMap.get(parentKey).isExtendable = true;
      }
      
      // ã€å¿œç”¨ã€‘ã‚‚ã—ã€Œé ­ã«1æ–‡å­—è¶³ã™ã€ã‚‚åˆ¤å®šã—ãŸã„å ´åˆã¯ã“ã“ã§è¡Œã†
      // const suffixKey = k.slice(1); 
      // if (dictionaryMap.has(suffixKey)) ...
    });
  });

const input = document.getElementById('query');
const results = document.getElementById('results');

input.addEventListener('input', () => {
  const q = normalize(input.value.trim());
  results.innerHTML = '';
  
  if (!q || q.length < 2) return;

  const matches = dictionary
    .filter(e => e.searchKey.includes(q))
    .sort((a, b) => a.searchKey.length - b.searchKey.length);

  for (const m of matches) {
    const li = document.createElement('li');
    
    // ãƒ•ãƒ©ã‚°ãŒç«‹ã£ã¦ã„ã‚Œã°ã‚¯ãƒ©ã‚¹ã‚’ä»˜ä¸
    if (m.isExtendable) {
      li.classList.add('extendable');
      li.title = "ã‚ã¨ã«1æ–‡å­—è¶³ã™ã¨ã€åˆ¥ã®è¨€è‘‰ã«ãªã‚Šã¾ã™"; // ãƒ›ãƒãƒ¼æ™‚ã®ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—
    }

    li.innerHTML = `
      <span class="word-reading">${m.reading}</span>
      <span class="word-notation">ã€${m.notation || '-'}ã€‘</span>
      <span class="word-meaning">${m.meaning || ''}</span>
    `;
    
    results.appendChild(li);
  }
});
  </script>
</body>
</html>
