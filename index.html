<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>もじぴったん 検索ツール</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      margin: 2rem;
      line-height: 1.6;
    }
    input {
      font-size: 1.1rem;
      padding: 0.4rem;
      width: 12rem;
    }
    ul {
      margin-top: 1rem;
      padding-left: 0;
      list-style: none; /* リストの・を消して見やすく */
    }
    li {
      margin-bottom: 0.5rem;
      border-bottom: 1px solid #eee; /* 区切り線 */
      padding-bottom: 0.5rem;
    }
    /* 見やすくするための装飾 */
    .word-reading {
      font-weight: bold;
      color: #007bff;
      margin-right: 0.5em;
    }
    .word-notation {
      font-weight: bold;
      margin-right: 0.5em;
    }
    .word-meaning {
      color: #555;
      font-size: 0.9em;
    }
  </style>
</head>
<body>
  <h1>もじぴったん 辞書検索</h1>

  <p>
    検索文字列(２文字以上)を入力すると、<br>
    <strong>その文字列を含む「読み」</strong>を持つ単語を表示します。
  </p>

  <input id="query" placeholder="例：あい" />

  <ul id="results"></ul>

  <script>
    // 小書き仮名 → 通常仮名
    const normalizeMap = {
      'ぁ':'あ','ぃ':'い','ぅ':'う','ぇ':'え','ぉ':'お',
      'ゃ':'や','ゅ':'ゆ','ょ':'よ','っ':'つ','ゎ':'わ'
    };

    function normalize(str) {
      return str
        .split('')
        // カタカナ → ひらがな
        .map(c => {
          const code = c.charCodeAt(0);
          if (code >= 0x30A1 && code <= 0x30F6) {
            return String.fromCharCode(code - 0x60);
          }
          return c;
        })
        // 小文字 → 大文字
        .map(c => normalizeMap[c] || c)
        .join('');
    }

    let dictionary = [];

    // dictionary.json を読み込む
    fetch('dictionary.json')
      .then(res => res.json())
      .then(data => {
        // ▼▼▼ ここを変更しました ▼▼▼
        dictionary = data
          .filter(e => e.reading && e.reading.length > 0)
          .map(e => ({
            searchKey: normalize(e.reading), // 検索用の正規化された読み（あいであまん）
            reading: e.reading,              // 表示用の元の読み（アイデアマン）
            notation: e.notation,            // 表記（idea man / 漢字など）
            meaning: e.meaning               // 意味
          }));
      });

    const input = document.getElementById('query');
    const results = document.getElementById('results');

    input.addEventListener('input', () => {
      const q = normalize(input.value.trim());
      results.innerHTML = '';
      
      // 2文字未満なら検索しない
      if (!q || q.length < 2) return;

      // ▼▼▼ 検索・表示処理を変更しました ▼▼▼
      const matches = dictionary
        .filter(e => e.searchKey.includes(q)) // searchKey(正規化済み)で検索
        .sort((a, b) => a.searchKey.length - b.searchKey.length);

      for (const m of matches) {
        const li = document.createElement('li');
        
        // 読みやすいようにHTMLタグを含めて整形
        // 例: アイデアマン 【idea man】 いい案をよく出す人。
        li.innerHTML = `
          <span class="word-reading">${m.reading}</span>
          <span class="word-notation">【${m.notation || '-'}】</span>
          <span class="word-meaning">${m.meaning || ''}</span>
        `;
        
        results.appendChild(li);
      }
    });
  </script>
</body>
</html>
