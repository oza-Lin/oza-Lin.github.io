<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>もじぴったん 検索ツール</title>
  <style>
    html {
  font-size: 16px;
}

input {
  font-size: 16px;
  min-height: 44px;
  padding: 6px 8px;
  transform: none;
}

    body {
      font-family: system-ui, sans-serif;
      margin: 2rem;
      line-height: 1.6;
    }
input {
      font-size: 16px; /* 【重要】ここを16px以上にする */
    min-height: 44px;
  padding: 6px 8px;
  }
    ul {
      margin-top: 1rem;
      padding-left: 0;
      list-style: none; /* リストの・を消して見やすく */
    }
    li {
      margin-bottom: 0.5rem;
      border-bottom: 1px solid #eee; /* 区切り線 */
      padding-bottom: 0.5rem;
    }
    /* 文字チップのスタイル */
.char-chip {
  display: inline-block;
  padding: 0px 6px;
  margin: 0 2px;
  border-radius: 4px;
  font-size: 0.85rem;
  font-weight: bold;
  cursor: pointer;
  border: 1px solid #ccc;
  transition: all 0.2s;
}

/* 後ろに足す文字（青系） */
.chip-next {
  background-color: #e1f5fe;
  color: #0288d1;
  border-color: #b3e5fc;
}
.chip-next:hover {
  background-color: #b3e5fc;
}

/* 前に足す文字（緑系） */
.chip-prev {
  background-color: #e8f5e9;
  color: #2e7d32;
  border-color: #c8e6c9;
}
.chip-prev:hover {
  background-color: #c8e6c9;
}

/* 単語自体の表示調整 */
.word-reading {
  font-weight: bold;
  font-size: 1.1em;
  margin: 0 0.5rem;
}
    /* 見やすくするための装飾 */
    .word-notation {
      font-weight: bold;
      margin-right: 0.5em;
    }
    .word-meaning {
      color: #555;
      font-size: 0.9em;
    }
    /* 1. 後ろに続く（Next）: 水色 */
.extend-next {
  background-color: #e1f5fe;
  border-left-color: #03a9f4;
}
.extend-next::after {
  content: ' ➡';
  color: #03a9f4;
}

/* 2. 前に付く（Prev）: 緑色 */
.extend-prev {
  background-color: #e8f5e9;
  border-left-color: #4caf50;
}
.extend-prev::before {
  content: '⬅ ';
  color: #4caf50;
}

/* 3. 両方（Both）: オレンジ/ピンク */
.extend-both {
  background-color: #fff3e0;
  border-left-color: #ff9800;
}
.extend-both::before {
  content: '⬅ ';
  color: #ff9800;
}
.extend-both::after {
  content: ' ➡';
  color: #ff9800;
}
  </style>
</head>
<body>
  <h1>もじぴったん 辞書検索</h1>

  <p>
    検索文字列(２文字以上)を入力すると、<br>
    その文字列を含む「読み」を持つ単語を表示します。<br>
    前や後ろに一文字加えることで別の単語になる場合、そこに矢印を表示します。
  </p>

  <input id="query" placeholder="例：あい" />

  <ul id="results"></ul>

  <script>
    // 小書き仮名 → 通常仮名
    const normalizeMap = {
      'ぁ':'あ','ぃ':'い','ぅ':'う','ぇ':'え','ぉ':'お',
      'ゃ':'や','ゅ':'ゆ','ょ':'よ','っ':'つ','ゎ':'わ'
    };

    function normalize(str) {
      return str
        .split('')
        // カタカナ → ひらがな
        .map(c => {
          const code = c.charCodeAt(0);
          if (code >= 0x30A1 && code <= 0x30F6) {
            return String.fromCharCode(code - 0x60);
          }
          return c;
        })
        // 小文字 → 大文字
        .map(c => normalizeMap[c] || c)
        .join('');
    }


// ...（normalize関数などは同じ）...

    let dictionary = [];
    const dictionaryMap = new Map();

    // クリックしたチップの文字を検索ボックスに入れて再検索する関数
    function searchWith(text) {
      const input = document.getElementById('query');
      input.value = text;
      // inputイベントを手動で発火させて検索を実行
      input.dispatchEvent(new Event('input'));
    }

    fetch('dictionary.json')
      .then(res => res.json())
      .then(data => {
        // 1. データ初期化
        dictionary = data
          .filter(e => e.reading && e.reading.length > 0)
          .map(e => ({
            searchKey: normalize(e.reading),
            reading: e.reading,
            notation: e.notation,
            meaning: e.meaning,
            // ▼ Setを使って「文字のリスト」を保存する形に変更
            nextChars: new Set(), // 後ろに足せる文字リスト
            prevChars: new Set()  // 前に足せる文字リスト
          }));

        // マップ登録
        dictionary.forEach(item => {
          if (!dictionaryMap.has(item.searchKey)) {
            dictionaryMap.set(item.searchKey, []);
          }
          dictionaryMap.get(item.searchKey).push(item);
        });

        // 2. 「逆引き」で文字を収集
        dictionary.forEach(longWord => {
          const k = longWord.searchKey;
          if (k.length < 2) return;

          // --- パターンA: 後ろにつながる文字を特定 ---
          // 例: longWord="りんごあ" (k) -> parent="りんご" (subNext)
          // 差分文字は kの最後の文字 ("あ")
          const subNext = k.slice(0, -1);
          const addedCharNext = k.slice(-1); // 末尾の1文字

          if (dictionaryMap.has(subNext)) {
            // "りんご" データ達の nextChars に "あ" を追加
            dictionaryMap.get(subNext).forEach(w => w.nextChars.add(addedCharNext));
          }

          // --- パターンB: 前につながる文字を特定 ---
          // 例: longWord="おりんご" (k) -> parent="りんご" (subPrev)
          // 差分文字は kの最初の文字 ("お")
          const subPrev = k.slice(1);
          const addedCharPrev = k.slice(0, 1); // 先頭の1文字

          if (dictionaryMap.has(subPrev)) {
            // "りんご" データ達の prevChars に "お" を追加
            dictionaryMap.get(subPrev).forEach(w => w.prevChars.add(addedCharPrev));
          }
        });
      });

    const input = document.getElementById('query');
    const results = document.getElementById('results');

    input.addEventListener('input', () => {
      const q = normalize(input.value.trim());
      results.innerHTML = '';
      if (!q || q.length < 2) return;

      const matches = dictionary
        .filter(e => e.searchKey.includes(q))
        .sort((a, b) => a.searchKey.length - b.searchKey.length);

      for (const m of matches) {
        const li = document.createElement('li');
        
        // --- チップ生成ロジック ---
        
        // 前の文字リスト (Set -> Array -> Sort -> HTML)
        const prevTags = Array.from(m.prevChars).sort().map(char => {
          // クリックしたら「その文字 + 今の単語」で検索
          // normalize前の単語を使うと複雑になるので、ここでは簡易的に searchKey を結合
          const nextQuery = char + m.searchKey;
          return `<span class="char-chip chip-prev" onclick="searchWith('${nextQuery}')">${char}</span>`;
        }).join('');

        // 後ろの文字リスト
        const nextTags = Array.from(m.nextChars).sort().map(char => {
          // クリックしたら「今の単語 + その文字」で検索
          const nextQuery = m.searchKey + char;
          return `<span class="char-chip chip-next" onclick="searchWith('${nextQuery}')">${char}</span>`;
        }).join('');

        // 表示の組み立て: [前チップ] 単語 [後チップ]
        li.innerHTML = `
          <div style="display: flex; align-items: center; flex-wrap: wrap;">
            <div>${prevTags}</div>
            <span class="word-reading">${m.reading}</span>
            <div>${nextTags}</div>
          </div>
          <div style="font-size: 0.85rem; color: #666; margin-left: 0.5rem;">
            【${m.notation || '-'}】 ${m.meaning || ''}
          </div>
        `;
        
        results.appendChild(li);
      }
    });
  </script>
</body>
</html>
